<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Mini Map Test</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    #map { width: 100%; height: 400px; min-height: 400px;}
    html,body { height:100%; margin:0; padding:0; }
  </style>
</head>
<body>
  <div id="map"></div>    <!-- BOŞ, class YOK! -->

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/maplibre-gl@3.5.2/dist/maplibre-gl.js"></script>
  <script src="https://unpkg.com/@maplibre/maplibre-gl-leaflet@0.1.3/leaflet-maplibre-gl.js"></script>
  <script>
    function getParam(name) {
      try {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
      } catch {
        return null;
      }
    }
    const lat = parseFloat(getParam("lat")) || 41.01;
    const lon = parseFloat(getParam("lon")) || 29.00;
    const zoom = 14;

    // Leaflet haritayı başlat
    const map = L.map('map').setView([lat, lon], zoom);

    // PROXY PATCH: Vektör Tile Layer ekle (proxy + console)
    fetch('https://tiles.openfreemap.org/styles/bright')
      .then(res => res.json())
      .then(style => {
        Object.keys(style.sources).forEach(src => {
          if (style.sources[src].url)
            style.sources[src].url = '/api/tile/{z}/{x}/{y}.pbf'; // Proxy endpointi!
        });
        console.log('[Proxy PATCH] MaplibreGL style sources now use your proxy:', style.sources);
        L.maplibreGL({
          style: style
        }).addTo(map)
          .on('tileload', function(e) {
            // Her tile yüklenince ekrana logla
            console.log('[Proxy TILE LOAD]', e.tile?.src || e.tile?._src || e);
          });
      });

    // Marker ekle
    L.marker([lat, lon]).addTo(map);
  </script>
</body>
</html>