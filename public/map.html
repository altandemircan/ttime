<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <title>Europe PMTiles (OpenMapTiles)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
      html, body, #map { height: 100%; margin: 0; }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <script src="https://unpkg.com/pmtiles@3.1.1/dist/pmtiles.js"></script>
    <script>
      // PMTiles protokolünü MapLibre'ye tanıt
      const protocol = new pmtiles.Protocol();
      maplibregl.addProtocol("pmtiles", protocol.tile);

      // PMTiles dosyanızın URL'si
      const PMTILES_URL = "pmtiles://https://pub-2a3f0dac44f546b682d7091808810236.r2.dev/ttime/europe-z13.pmtiles";

      // Basit OpenMapTiles uyumlu stil (ikon yok; su, yollar, binalar vs. görünür)
      const style = {
        version: 8,
        glyphs: "https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf",
        sources: {
          omt: {
            type: "vector",
            url: PMTILES_URL,
            maxzoom: 14
          }
        },
        layers: [
          { id: "background", type: "background", paint: { "background-color": "#f5f7fa" } },

          // Su
          { id: "water", type: "fill", source: "omt", "source-layer": "water",
            paint: { "fill-color": "#a0c8f0" } },

          // Landcover / park / landuse (basit yeşiller)
          { id: "landcover", type: "fill", source: "omt", "source-layer": "landcover",
            paint: { "fill-color": ["match", ["get","class"], "grass", "#dbead1", "forest", "#cfe8c9", "wood", "#cfe8c9", "#e9efe6"] }, minzoom: 5 },
          { id: "park", type: "fill", source: "omt", "source-layer": "park",
            paint: { "fill-color": "#d7ecd1" }, minzoom: 5 },
          { id: "landuse", type: "fill", source: "omt", "source-layer": "landuse",
            paint: { "fill-color": "#eae7e0", "fill-opacity": 0.5 }, minzoom: 5 },

          // Sınırlar
          { id: "boundary", type: "line", source: "omt", "source-layer": "boundary",
            paint: { "line-color": "#aaaaaa", "line-width": ["interpolate", ["linear"], ["zoom"], 3, 0.4, 8, 1, 10, 1.2] } },

          // Yollar (alt kat: kenar)
          { id: "road-casing", type: "line", source: "omt", "source-layer": "transportation",
            paint: {
              "line-color": "#bfbfbf",
              "line-width": ["interpolate", ["linear"], ["zoom"], 6, 0.5, 10, 2, 12, 3, 14, 5]
            }, minzoom: 6 },

          // Yollar (üst kat: gövde)
          { id: "road", type: "line", source: "omt", "source-layer": "transportation",
            paint: {
              "line-color": ["match", ["get","class"],
                "motorway", "#ff8c69",
                "trunk",    "#ffb27a",
                "primary",  "#ffd08a",
                "secondary","#ffffff",
                "tertiary", "#ffffff",
                "minor",    "#ffffff",
                "#ffffff"
              ],
              "line-width": ["interpolate", ["linear"], ["zoom"], 6, 0.3, 10, 1.5, 12, 2.5, 14, 4]
            }, minzoom: 6 },

          // Binalar
          { id: "building", type: "fill", source: "omt", "source-layer": "building",
            paint: { "fill-color": "#d6d3d0", "fill-outline-color": "#c8c5c2" }, minzoom: 13 },

          // Su isimleri
          { id: "water_name", type: "symbol", source: "omt", "source-layer": "water_name",
            layout: {
              "text-field": ["coalesce", ["get","name:latin"], ["get","name"]],
              "text-font": ["Noto Sans Regular"],
              "text-size": ["interpolate", ["linear"], ["zoom"], 5, 10, 12, 14]
            },
            paint: { "text-color": "#4f86c6" } },

          // Yol isimleri
          { id: "road_name", type: "symbol", source: "omt", "source-layer": "transportation_name",
            layout: {
              "text-field": ["coalesce", ["get","name:latin"], ["get","name"]],
              "text-font": ["Noto Sans Regular"],
              "text-size": ["interpolate", ["linear"], ["zoom"], 12, 10, 16, 13],
              "symbol-placement": "line"
            },
            paint: { "text-color": "#666", "text-halo-color": "#fff", "text-halo-width": 1 } },

          // Yer isimleri (şehir/köy)
          { id: "place", type: "symbol", source: "omt", "source-layer": "place",
            layout: {
              "text-field": ["coalesce", ["get","name:latin"], ["get","name"]],
              "text-font": ["Noto Sans Regular"],
              "text-size": ["interpolate", ["linear"], ["zoom"], 4, 10, 8, 12, 12, 14],
              "text-anchor": "center"
            },
            paint: { "text-color": "#333", "text-halo-color": "#fff", "text-halo-width": 1 } }
        ]
      };

      const map = new maplibregl.Map({
        container: "map",
        style,
        center: [28.97, 41.01], // İstanbul
        zoom: 5
      });

      // İsteğe bağlı: zoom/konum kontrolleri
      map.addControl(new maplibregl.NavigationControl({ showCompass: false }), "top-right");
    </script>
  </body>
</html>